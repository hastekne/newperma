@model Tuple<SeccionAdministrador.Models.ModuloViewModel,SeccionAdministrador.Models.EjeViewModel,SeccionAdministrador.Models.FuncionDesarrolloPViewModel>

<!--pop up strat here-->
<script src="@Url.Content("~/Scripts/jquery.magnific-popup.js")" type="text/javascript"></script>
<script type="text/javascript">
    $(document).ready(function () {
        $('.popup-with-zoom-anim').magnificPopup({
            type: 'inline',
            fixedContentPos: false,
            fixedBgPos: true,
            overflowY: 'auto',
            closeBtnInside: true,
            preloader: false,
            midClick: true,
            removalDelay: 300,
            mainClass: 'my-mfp-zoom-in'
        });

    });



</script>
<form>

    <div class="section"><span>a</span>Título de la Buena Práctica</div>

    <div class="inner-wrap">
        @using (Html.BeginForm("ActualizarTitulo", "Admin"))
        {
            <input name="txtTituloModulo" id="txtTituloModulo" type="text" required maxlength="100" value="@Model.Item1.titulo" />
        }
            <div class="compose-block" style="background: none">
                <div class="button-section compose compose-bottom" align="right">
                    <button class="compose compose-bottom" onclick="GuardarTitulo()">Guardar</button>
                </div>
            </div>
        </div>
    <hr>
    <br>

    <div class="section"><span>b</span>Introducción</div>
    <div class="inner-wrap" style="width: 100%">

        <table width="100%" border="0" align="center" style="height:10px; ">
            <tbody>
                <tr>
                    
                        <td colspan="2" width="70%">
                            <br>

                            <input type="file" style="border: none; resize: none; width: 100%" name="choose_file" id="choose_file" class="inputfile custom" accept=".pdf,.jpeg,.png,.jpg,.pptx,.docx" />
                            <label for="choose_file">
                                <span id="file_name">Archivo</span><strong style="color: #FFFFFF">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="17" viewBox="0 0 20 17" color="#FFFFFF" style="color: #FFFFFF "><path d="M10 0l-5.2 4.9h3.3v5.1h3.8v-5.1h3.3l-5.2-4.9zm9.3 11.5l-3.2-2.1h-2l3.4 2.6h-3.5c-.1 0-.2.1-.2.1l-.8 2.3h-6l-.8-2.2c-.1-.1-.1-.2-.2-.2h-3.6l3.4-2.6h-2l-3.2 2.1c-.4.3-.7 1-.6 1.5l.6 3.1c.1.5.7.9 1.2.9h16.3c.6 0 1.1-.4 1.3-.9l.6-3.1c.1-.5-.2-1.2-.7-1.5z"></path></svg>
                                </strong>
                            </label>

                            <!--- script para que cambie el noimbre del archivo --->
                            <script>
                                'use strict';
                                $(function () {
                                    $('.inputfile').each(function () {
                                        var $input = $(this);
                                        $input.on('change', function (e) {
                                            var fileName = '';
                                            if (e.target.value) {
                                                fileName = e.target.value.split('\\').pop();
                                            }
                                            if (fileName) {
                                                var $fileName = $('#file_name');
                                                $fileName.html(fileName);
                                            } else {
                                                $fileName.html('');
                                            }
                                        });
                                    });
                                });</script>

                        </td>
                        <td width="15%">
                           
                                <div class="compose-block" style="background: none">
                                    <div class="button-section compose compose-bottom" align="right">
                                        <button class="compose compose-bottom" onclick="Subir('Intro')">Subir</button>
                                    </div>
                                </div>
                            
                            </td>
                        <td width="15%">
                            <div class="compose-block" style="background: none">
                                <div class="button-section compose compose-bottom" align="right">
                                    <button class="compose compose-bottom" onclick="VistaPreviaArchivo('Intro')">Ver</button>
                                </div>
                            </div>
                        </td>
                        
                    </tr>
            </tbody>
        </table>


    </div>



    <hr>

    <br>

    <div class="section"><span>c</span>Buena Práctica del mes</div>
    <div class="inner-wrap">

        <table width="100%">
            <tbody>
                <tr>
                    <td width="70%">
                        &shy; <input type="file" style="border: none; resize: none; width: 100%;" name="choose_file3" id="choose_file3" class="inputfile3 custom" accept=".pptx,.webm,.ogv,.m4v" />
                        <label for="choose_file3">
                            <span id="file_name3">Archivo</span><strong style="color: #FFFFFF">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="17" viewBox="0 0 20 17" color="#FFFFFF" style="color: #FFFFFF "><path d="M10 0l-5.2 4.9h3.3v5.1h3.8v-5.1h3.3l-5.2-4.9zm9.3 11.5l-3.2-2.1h-2l3.4 2.6h-3.5c-.1 0-.2.1-.2.1l-.8 2.3h-6l-.8-2.2c-.1-.1-.1-.2-.2-.2h-3.6l3.4-2.6h-2l-3.2 2.1c-.4.3-.7 1-.6 1.5l.6 3.1c.1.5.7.9 1.2.9h16.3c.6 0 1.1-.4 1.3-.9l.6-3.1c.1-.5-.2-1.2-.7-1.5z"></path></svg>
                            </strong>
                        </label>

                        <!--- script para que cambie el noimbre del archivo --->
                        <script>
                            'use strict';
                            $(function () {
                                $('.inputfile3').each(function () {
                                    var $input = $(this);
                                    $input.on('change', function (e) {
                                        var fileName = '';
                                        if (e.target.value) {
                                            fileName = e.target.value.split('\\').pop();
                                        }
                                        if (fileName) {
                                            var $fileName = $('#file_name3');
                                            $fileName.html(fileName);
                                        } else {
                                            $fileName.html('');
                                        }
                                    });
                                });
                            });</script>
                    </td>
                    <td width="15%">
                        <div class="compose-block" style="background: none">
                            <div class="button-section compose compose-bottom" align="right">
                                <button class="compose compose-bottom" onclick="Subir('MBP')">Subir</button>
                            </div>
                        </div>
                    </td>
                    <td width="15%">
                        <div class="compose-block" style="background: none">
                            <div class="button-section compose compose-bottom" align="right">
                                <button class="compose compose-bottom" onclick="VistaPreviaArchivo('MBP')">Descargar</button>
                            </div>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>

        <br>


    </div>


    <hr>

    <br>

    <div class="section"><span>d</span>Eje de la Buena Páctica.  </div>
    <div class="inner-wrap" style="padding-top: -50px">

        <table width="100%">
            <tbody>
                <tr>
                    Nombre:
                    <td width="80%">
                        <input id="txtEje" name="txtEje" type="text" style="border: none; resize: none; width: 100%;" />



                    </td>
                    <td width="20%">
                        <div class="compose-block" style="background: none">
                            <div class="button-section compose compose-bottom" align="right">
                                <button class="compose compose-bottom" onclick="Nuevo('eje')">Guardar</button>
                            </div>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <br>
        @*<div align="center">
            <table class="table tab-border" style="text-decoration-color: #000000; align-content: center" align="center">

                <tr class="unread checked">

                    <th align="center" style="text-align: center; width: 60%">Nombre</th>
                    <th align="center" style="text-align: center; width: 30%">Actualizar</th>
                    <th align="center" style="text-align: center; width: 10%">Estado</th>

                </tr>
                <tbody>
                    <tr class="unread checked">
                        <td>
                            Eje de Convivencia
                        </td>
                        <td>
                            <a href="#actualizar" class="popup-with-zoom-anim"><i class="glyphicon glyphicon-edit" aria-hidden="true"></i></a>



                            <!--pop-up-grid-->
                            <div id="eje">
                                <div id="actualizar" class="mfp-hide" style="background: white; padding: 10px 0 10px 0; max-width: 629px; margin: 40px auto; position: relative; height:150px; border-radius: 5px;">
                                    <div class="pop_up">
                                        <div class="container">
                                            <div id="title">

                                                <div style="padding-top: 8px; padding-left: 10px; text-align: left; margin-left: 15px; margin-right: 15px" class="chit-chat-heading">Actualizar Eje</div>

                                            </div>
                                            <div class="form-style-10" style="width: 100%; height:200px;padding-top: -20px; margin-top: -20px">

                                                Nombre:
                                                <input name="" type="text" required maxlength="100" value="" />

                                                <div class="compose-block" style="background: none">
                                                    <div class="button-section compose compose-bottom" align="right">
                                                        <a class="compose compose-bottom" href="documentar.html">Guardar</a>
                                                    </div>
                                                </div>

                                            </div>

                                        </div>
                                    </div>
                                </div>


                            </div>

                            <!--pop-up-grid-->
                        </td>

                        <td align="center">
                            <ul>
                                <i class="glyphicon glyphicon-remove-circle" aria-hidden="true" style="color:red;"></i>

                            </ul>
                        </td>
                    </tr>

                    <tr class="unread checked">
                        <td>
                            Eje de desarrollo cognitivo
                        </td>
                        <td>
                            <a href="#actualizar1" class="popup-with-zoom-anim"><i class="glyphicon glyphicon-edit" aria-hidden="true"></i></a>



                            <!--pop-up-grid-->
                            <div id="eje1">
                                <div id="actualizar1" class="mfp-hide" style="background: white; padding: 10px 0 10px 0; max-width: 629px; margin: 40px auto; position: relative; height:150px; border-radius: 5px;">
                                    <div class="pop_up">
                                        <div class="container">
                                            <div style="padding-top: 8px; padding-left: 10px; text-align: left; margin-left: 15px; margin-right: 15px" class="chit-chat-heading">Actualizar Eje</div>

                                        </div>
                                        <div class="form-style-10" style="width: 100%; height:200px;padding-top: -20px; margin-top: -20px">

                                            Nombre:
                                            <input name="" type="text" required maxlength="100" value="" />

                                            <div class="compose-block" style="background: none">
                                                <div class="button-section compose compose-bottom" align="right">
                                                    <a class="compose compose-bottom" href="documentar.html">Guardar</a>
                                                </div>
                                            </div>

                                        </div>

                                    </div>
                                </div>
                            </div>
                            <!--pop-up-grid-->




                        </td>

                        <td align="center">
                            <ul>
                                <i class="glyphicon glyphicon-ok-circle" aria-hidden="true" style="color:green;"></i>

                            </ul>
                        </td>
                    </tr>




                </tbody>
            </table>

        </div>*@
        <div id="partialTblEje">
            @Html.Partial("ModuloBP/_TablaEje",Model.Item2)
        </div>
        
    </div>

    <hr>
    <br>

    <div class="section"><span>e</span>Función de Desarrollo de la Buena Páctica.   </div>
    <div class="inner-wrap">
        <table width="100%">
            <tbody>
                <tr>
                    Nombre:
                    <td width="80%">
                        <input id="txtFuncion" name="txtFuncion" type="text" style="border: none; resize: none; width: 100%;" />



                    </td>
                    <td width="20%">
                        <div class="compose-block" style="background: none">
                            <div class="button-section compose compose-bottom" align="right">
                                <button class="compose compose-bottom" onclick="Nuevo('funcion')">Guardar</button>
                            </div>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>

        <br>

        @*<div align="center">


            <table class="table tab-border" style="text-decoration-color: #000000; align-content: center" align="center">


                <tr class="unread checked">


                    <th align="center" style="text-align: center; width: 60%">Nombre</th>

                    <th align="center" style="text-align: center; width: 30%">Actualizar</th>

                    <th align="center" style="text-align: center; width: 10%">Estado</th>


                </tr>

                <tbody>

                    <tr class="unread checked">

                        <td>
                            Director secundaria tecnica

                        </td>

                        <td>

                            <a href="#actualizar2" class="popup-with-zoom-anim"><i class="glyphicon glyphicon-edit" aria-hidden="true"></i></a>



                            <!--pop-up-grid-->
                            <div id="cargo">
                                <div id="actualizar2" class="mfp-hide" style="background: white; padding: 10px 0 10px 0; max-width: 629px; margin: 40px auto; position: relative; height:150px; border-radius: 5px;">
                                    <div class="pop_up">
                                        <div class="container">
                                            <div id="title">

                                                <div style="padding-top: 8px; padding-left: 10px; text-align: left; margin-left: 15px; margin-right: 15px" class="chit-chat-heading">Actualizar Función</div>

                                            </div>
                                            <div class="form-style-10" style="width: 100%; height:200px;padding-top: -20px; margin-top: -20px">

                                                Nombre:
                                                <input name="" type="text" required maxlength="100" value="" />

                                                <div class="compose-block" style="background: none">
                                                    <div class="button-section compose compose-bottom" align="right">
                                                        <a class="compose compose-bottom" href="documentar.html">Guardar</a>
                                                    </div>
                                                </div>

                                            </div>

                                        </div>
                                    </div>
                                </div>


                            </div>

                            <!--pop-up-grid-->
                        </td>

                        <td align="center">
                            <ul>
                                <i class="glyphicon glyphicon-remove-circle" aria-hidden="true" style="color:red;"></i>

                            </ul>
                        </td>
                    </tr>

                    <tr class="unread checked">
                        <td>
                            Docente de la Materia de español 2 grado
                        </td>
                        <td>
                            <a href="#actualizar3" class="popup-with-zoom-anim"><i class="glyphicon glyphicon-edit" aria-hidden="true"></i></a>



                            <!--pop-up-grid-->
                            <div id="cargo1">
                                <div id="actualizar3" class="mfp-hide" style="background: white; padding: 10px 0 10px 0; max-width: 629px; margin: 40px auto; position: relative; height:150px; border-radius: 5px;">
                                    <div class="pop_up">
                                        <div class="container">
                                            <div style="padding-top: 8px; padding-left: 10px; text-align: left; margin-left: 15px; margin-right: 15px" class="chit-chat-heading">Actualizar Función</div>

                                        </div>
                                        <div class="form-style-10" style="width: 100%; height:200px;padding-top: -20px; margin-top: -20px">

                                            Nombre:
                                            <input name="" type="text" required maxlength="100" value="" />

                                            <div class="compose-block" style="background: none">
                                                <div class="button-section compose compose-bottom" align="right">
                                                    <a class="compose compose-bottom" href="documentar.html">Guardar</a>
                                                </div>
                                            </div>

                                        </div>

                                    </div>
                                </div>
                            </div>
                            <!--pop-up-grid-->

                        </td>

                        <td align="center">
                            <ul>
                                <i class="glyphicon glyphicon-ok-circle" aria-hidden="true" style="color:green;"></i>

                            </ul>
                        </td>
                    </tr>




                </tbody>
            </table>



        </div>*@
        <div id="tablaFuncionD">
            @Html.Partial("ModuloBP/_TablaFuncionesD",Model.Item3)
            </div>
    </div>
</form>

<script type="text/javascript">

    function VistaPreviaArchivo(sec) {
        $('button').prop('disabled', true);
        $("body").css("cursor", "progress");
        $("button").css("cursor", "progress");
         if (sec == "Intro")
                     window.open("VistaPreviaArchivo?seccion=" + sec, "Vista previa", "width=600, height=400");
                 else
                     window.location.href="@Url.Action("VistaPreviaArchivo", "Admin", new { seccion = "MBP" })"
        
        $("body").css("cursor", "default");
        $("button").css("cursor", "pointer");
        $('button').prop('disabled', false);
    }

    function GuardarTitulo() {
        $('button').prop('disabled', true);
        $("body").css("cursor", "progress");
        $("button").css("cursor", "progress");
        var t = document.getElementById("txtTituloModulo").value;

        //Falt poner diag en el IF
        if (t == "") {
            alert("El campo de título no debe estar vacío.");
            $('button').prop('disabled', false);
        } else {
            $.ajax({
                url: "@Url.Action("ActualizarTitulo", "Admin")",
                method: "POST",
                data: { titulo: t },
               // datatype: "json",
                success: function (data) {
                    if (data == "false") {
                        alert("Error al guardar el titulo");
                    } else {
                        alert("Titulo Guardado");
                    }
                    $("body").css("cursor", "default");
                    $("button").css("cursor", "pointer");
                    $('button').prop('disabled', false);
                },
                error: function () {
                    alert("Error.");
                    $("body").css("cursor", "default");
                    $("button").css("cursor", "pointer");
                    $('button').prop('disabled', false);
                }
            });
        }
    }

    function Subir(s) {
        
        var i = "";
        if (s == "Intro") {
            i = "choose_file";
        } else {
            i = "choose_file3";
        }
        var input = document.getElementById(i);
        var fReader = new FileReader();
        fReader.readAsDataURL(input.files[0]);
        fReader.onloadend = function (event) {
            $("body").css("cursor", "progress");
            $("button").css("cursor", "progress");
            $('button').prop('disabled', true);
            var ruta2 = event.target.result;
            //Falt poner diag en el IF
            //if (t == "") {
            //    alert("El campo de título no debe estar vacío.");
            //} else {
           
                $.ajax({
                    url: "@Url.Action("Subir", "Admin")",
                    method: "POST",
                    data: { seccion:s,ruta: ruta2, archivo: input.value },
                    // datatype: "json",
                    success: function (data) {
                        if (data == "false") {
                            alert("Error al subir el archivo.");
                        } else {
                            alert("Archivo cargado.");
                        }
                        $("body").css("cursor", "default");
                        $("button").css("cursor", "pointer");
                        $('button').prop('disabled', false);
                    },
                    error: function () {
                        alert("Error.");
                        $("body").css("cursor", "default");
                        $("button").css("cursor", "pointer");
                        $('button').prop('disabled', false);
                    }
                });
            //}
        }
   
    }

    function Nuevo(s) {
        $("body").css("cursor", "progress");
        $("button").css("cursor", "progress");
        var t = "";
        if (s == "eje") {
            t = "txtEje";
        } else {
            t = "txtFuncion";
        }
        var n = document.getElementById(t).value;
        if (n != "") {
            $.ajax({
                    url: "@Url.Action("Nuevo", "Admin")",
                    method: "POST",
            data: { seccion: s, nuevo: n},
                    datatype: "html",
            success: function (response) {
                if (s == "eje") {
                    $('#partialTblEje').html(response);
                } else {
                    $('#tablaFuncionD').html(response);
                }
                $("body").css("cursor", "default");
                $("button").css("cursor", "pointer");
                    },
                    error: function () {
                        alert("Error al agregar.");
                        $("body").css("cursor", "default");
                        $("button").css("cursor", "pointer");
                    }
                });
        } else {
            alert("Campo obligatorio vacío.");
            $("body").css("cursor", "default");
            $("button").css("cursor", "pointer");
        }
        
    }

</script>


