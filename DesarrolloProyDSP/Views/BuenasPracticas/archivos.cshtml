@*@model Tuple<DesarrolloProyDSP.Models.ModuloBP.CampoBPViewModel, DesarrolloProyDSP.Models.ModuloBP.ImagenBPViewModel>*@
@using PagedList.Mvc
@model Tuple<DesarrolloProyDSP.Models.ModuloBP.CampoBPViewModel, DesarrolloProyDSP.Models.ModuloBP.ImagenBPViewModel, PagedList.IPagedList<BusinessModel.Models.ModuloBP.TabImagenBP>, PagedList.IPagedList<BusinessModel.Models.ModuloBP.TabImagenRevisionBP>>

@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    @*<meta name="viewport" content="width=device-width" />
        <title>Autores</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="keywords" content="Hablar sobre la plataforma SEG" />
        <script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } </script>
        <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
        <!-- <link href="css/bootstrap.css" rel="stylesheet" type="text/css" media="all">-->
        <link href="@Url.Content("~/css/bootstrap.css")" rel="stylesheet" type="text/css" media="all">
        <!-- Custom Theme files -->
        <!--<link href="css/style.css" rel="stylesheet" type="text/css" media="all" />-->
        <link href="@Url.Content("~/css/style.css")" rel="stylesheet" type="text/css" media="all">
        <link href="@Url.Content("~/css/glyphicons.css")" rel="stylesheet" type="text/css" media="all">
        <!--js-->
        <script src="@Url.Content("~/Scripts/jquery-2.1.1.min.js")"></script>
        <!--icons-css-->
        <link href="@Url.Content("~/css/font-awesome.css")" rel="stylesheet">
        <link href="@Url.Content("~/css/panel.css")" rel="stylesheet">
        <link href="@Url.Content("~/css/materialdesignicons.min.css")" rel="stylesheet">
        <link href="@Url.Content("~/css/material-design-iconic-font.min.css")" rel="stylesheet">
        <link href="@Url.Content("~/css/material-design-iconic-font.css")" rel="stylesheet">

        <!--Google Fonts-->


        <link href='//fonts.googleapis.com/css?family=Carrois+Gothic' rel='stylesheet' type='text/css'>
        <link href='//fonts.googleapis.com/css?family=Work+Sans:400,500,600' rel='stylesheet' type='text/css'>

        <!--button css-->
        <link href="@Url.Content("~/css/demo-page.css")" rel="stylesheet" media="all">
        <link href="@Url.Content("~/css/hover.css")" rel="stylesheet" media="all">

        <!--static chart-->
        <script src="@Url.Content("~/Scripts/Chart.min.js")"></script>
        <!--//charts-->
        <script src="@Url.Content("~/Scripts/sidebarmenu.js")"></script>
        <!-- geo chart -->
        <script src="//cdn.jsdelivr.net/modernizr/2.8.3/modernizr.min.js" type="text/javascript"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <script>window.modernizr || document.write('<script src="lib/modernizr/modernizr-custom.js"><\/script>')</script>
        <!--<script src="lib/html5shiv/html5shiv.js"></script>-->
        <!--pop up strat here-->
        <script src="@Url.Content("~/Scripts/jquery.magnific-popup.js")" type="text/javascript"></script>
        <script type="text/javascript">
            $(document).ready(function () {
                $('.popup-with-zoom-anim').magnificPopup({
                    type: 'inline',
                    fixedContentPos: false,
                    fixedBgPos: true,
                    overflowY: 'auto',
                    closeBtnInside: true,
                    preloader: false,
                    midClick: true,
                    removalDelay: 300,
                    mainClass: 'my-mfp-zoom-in'
                });

            });
        </script>

        <!-- agregar autor  -->
        <!--pop up end here-->
        <!--skycons-icons-->
        <script src="@Url.Content("~/Scripts/skycons.js")"></script>*@
    <!--//skycons-icons-->

    @Html.Partial("../ViewPartialPrincipales/_ScriptsLink")
</head>
<body>
    <div class="page-container">
        <div class="left-content">
            <div class="mother-grid-inner">
                <!--header start here-->
                @*<div class="header-main">

            <div class="row header-content">

                <div>

                    <a href="http://www.seg.guanajuato.gob.mx">
                        <img src=@Url.Content("~/image/editable_logo.png") width="130" alt="SEG" />

                    </a> 	 <div style="margin-top: -60px; color: #FFFFFF" align="center" class="chit-chat-heading" id="titulo">
                        <p>Permanencia Escolar en la Educación Media Superior</p><br>

                    </div>


                    <nav id="main-nav-wrap" class="main-nav-wrap">
                        <ul class="main-navigation">
                            <li><a href="index" title="">Inicio</a></li>
                            <li class="has-children">
                                <a href="Administrador/category.html" title="">Recursos Educativos</a>
                                <!--SUB MENU  <ul class="sub-menu">
                                   <li><a href="category.html">Wordpress</a></li>
                                   <li><a href="category.html">HTML</a></li>
                                   <li><a href="category.html">Photography</a></li>
                                   <li><a href="category.html">UI</a></li>
                                   <li><a href="category.html">Mockups</a></li>
                                   <li><a href="category.html">Branding</a></li>
                                </ul>-->
                            </li>
                            <li class="has-children">
                                <a href="@Url.Action("Practicas","BuenasPracticas")" title="">Buenas pr&aacute;cticas</a>
                                <!--SUB MENU    <ul class="sub-menu">
                                   <li><a href="single-video.html">Video Post</a></li>
                                   <li><a href="single-audio.html">Audio Post</a></li>
                                   <li><a href="single-gallery.html">Gallery Post</a></li>
                                   <li><a href="single-standard.html">Standard Post</a></li>
                                </ul>-->
                            </li>
                            <li><a href="Administrador/style-guide.html" title="">Becas y Apoyos</a></li>
                            <li><a href="ActividadesA.html" title="">Actividades Acad&eacute;micas</a></li>
                            <li><a href="Administrador/contact.html" title="">Contacto</a></li>
                            <li class="hvr-icon-buzz-out" style="background:none; color: #FFFCFC; height: auto; margin-top: -13px; margin-bottom: -20px"><a href="@Url.Action("CerrarSesion","BuenasPracticas")">Cerrar sesión</a></li>

                        </ul>
                    </nav> <!-- end main-nav-wrap -->



                </div>
            </div>






        </div>*@
                @Html.Partial("../ViewPartialPrincipales/_Header")

                <!--heder end here-->
                <!-- script-for sticky-nav -->
                <script>
                    $(document).ready(function () {
                        var navoffeset = $(".header-main").offset().top;
                        $(window).scroll(function () {
                            var scrollpos = $(window).scrollTop();
                            if (scrollpos >= navoffeset) {
                                $(".header-main").addClass("fixed");
                            } else {
                                $(".header-main").removeClass("fixed");
                            }
                        });

                    });
                </script>
                <!-- /script-for sticky-nav -->
                <!--inner block start here-->
                <div class="inner-block" style="margin-top: -20px">
                    <!--inner block start here-->



                    <div class="chit-chat-layer1" style="margin-top: -50px">

                        <div class="col-md-12 mailbox-content  tab-content tab-content-in" style="padding-right: 30px; padding-top: 10px">

                            <div class="col-md-4 compose">
                                <div class="compose-block" style="width:400px; " align="right">

                                    <div class="compose-bottom">
                                        @if (ViewBag.perfil == "Colaborador")
                                        {
                                            <div style="padding-top: 8px; padding-left: 10px; text-align: left" class="chit-chat-heading">Agregar Imagenes y Anexos</div>
                                        }
                                        else
                                        {
                                            <div style="padding-top: 8px; padding-left: 10px; text-align: left" class="chit-chat-heading">Agregar Imagenes</div>
                                        }


                                        <p class="text" style="color: #5C5959; font-size:14px; text-align: left; padding-left: 10px; ">Referencia para cada sección de la Buena Práctica</p> <br>


                                        <select name="selectCampoBP" id="selectCampoBP" class="autor" style="width: 100%; z-index: auto; border: none">

                                            @foreach (var item in Model.Item1.listCamposBP)
                                            {
                                                <option id="@item.idCampo">@item.nombre</option>
                                            }


                                        </select>

                                        <br>
                                        <br>



                                        <table width="100%" border="0">
                                            <tbody>

                                                <tr>
                                                    <td><input name="tituloArchivo" id="tituloArchivo" type="text" required class="autor" style="border: none; resize: none; width: 100%" placeholder="Título del archivo" align="right " /></td>
                                                    <td style="padding-left:20px;"><input placeholder="Numeración" name="numArchivo" id="numArchivo" type="number" required class="autor" style="border: none; resize: none; width: 100%" max="50" min="1" pattern="(\[0-9]\)" autocomplete="on" value="Figura" align="right" /></td>
                                                </tr>
                                                <tr>
                                                    <td colspan="2">
                                                        <br>
                                                        @if (ViewBag.perfil == "Colaborador")
                                                        {
                                                            <input type="file" style="border: none; resize: none; width: 100%" name="choose_file" id="choose_file" class="inputfile custom" accept=".jpeg,.png,.jpg,.pdf" />
                                                        }
                                                        else
                                                        {
                                                            <input type="file" style="border: none; resize: none; width: 100%" name="choose_file" id="choose_file" class="inputfile custom" accept=".jpeg,.png,.jpg" />
                                                        }

                                                        <label for="choose_file">
                                                            <span id="file_name">Archivo</span><strong style="color: #FFFFFF">
                                                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="17" viewBox="0 0 20 17" color="#FFFFFF" style="color: #FFFFFF "><path d="M10 0l-5.2 4.9h3.3v5.1h3.8v-5.1h3.3l-5.2-4.9zm9.3 11.5l-3.2-2.1h-2l3.4 2.6h-3.5c-.1 0-.2.1-.2.1l-.8 2.3h-6l-.8-2.2c-.1-.1-.1-.2-.2-.2h-3.6l3.4-2.6h-2l-3.2 2.1c-.4.3-.7 1-.6 1.5l.6 3.1c.1.5.7.9 1.2.9h16.3c.6 0 1.1-.4 1.3-.9l.6-3.1c.1-.5-.2-1.2-.7-1.5z"></path></svg>
                                                            </strong>
                                                        </label>

                                                        <!--- script para que cambie el noimbre del archivo --->
                                                        <script>
                                                            'use strict';
                                                            $(function () {
                                                                $('.inputfile').each(function () {
                                                                    var $input = $(this);
                                                                    $input.on('change', function (e) {
                                                                        var fileName = '';
                                                                        if (e.target.value) {
                                                                            fileName = e.target.value.split('\\').pop();
                                                                        }
                                                                        if (fileName) {
                                                                            var $fileName = $('#file_name');
                                                                            $fileName.html(fileName);
                                                                        } else {
                                                                            $fileName.html('');
                                                                        }
                                                                    });
                                                                });
                                                            });</script>

                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>




                                    </div>
                                    <br>


                                    @if (ViewBag.perfil == "Colaborador")
                                    {
                                        <a onclick="SubirArchivo()" style="margin-right: -275px">Subir</a>
                                    }
                                    else
                                    {
                                        <a onclick="SubirArchivoRevision()" style="margin-right: -275px">Subir</a>
                                    }



                                </div>





                            </div>

                            <div class="col-md-8 mailbox-content  tab-content tab-content-in" align="right">
                                <div>
                                    <div class="header-left">







                                    </div>


                                    <div class="clearfix"> </div>
                                    @*<div style="padding-top: 8px; padding-left: 10px; text-align: left" class="chit-chat-heading"> ARCHIVOS DE LA BUENA PRÁCTICA </div>

                            <span class="text-muted m-r-sm">
                                Mostrar @(Model.Item3.PageCount < Model.Item3.PageNumber ? 0 : Model.Item3.PageNumber)
                                de @Model.Item3.PageCount
                            </span>

                            <div class="btn-group">
                                @Html.PagedListPager(Model.Item3, page => Url.Action("Archivos", new { page }))
                            </div>*@

                                    <div class="clearfix"> </div>
                                </div>


                                <!--inicia contenido correos-->
                                @*<table class="table tab-border" style="text-decoration-color: #000000">

                            <tr>

                                <th width="10%" align="center" style="text-align: center">Figura</th>

                                <th width="51%">Título</th>
                                <th width="51%">Campo BP</th>
                                <th width="18%" align="center" style="text-align: center">Previsualización</th>
                                <th width="14%" align="center" style="text-align: center">Eliminar</th>

                            </tr>
                            <tbody>
                                @for (int i = 0; i < Model.Item3.Count; i++)
                                {
                                    <tr class="unread checked">
                                        <td align="center">
                                            @Model.Item3[i].figura
                                        </td>
                                        <td>
                                            @Model.Item3[i].Titulo
                                        </td>
                                        <td>
                                            @Model.Item3[i].campoBP
                                        </td>
                                        <td align="center">
                                            <a class="popup-with-zoom-anim" href="#Figura1"><i class="fa fa-paperclip"></i></a>

                                            <!--pop-up-grid-->
                                            <div id="popup">
                                                <div id="Figura1" class="mfp-hide" style="background: white; padding: 10px 0 10px 0; max-width: 629px; margin: 40px auto; position: relative; height:300px; border-radius: 5px;">
                                                    <div class="pop_up">
                                                        <div class="payment-online-form-left">
                                                            <img src="image/Constancia_aprendizajesclave.png" width="100%" height="100%" alt="" />
                                                        </div>
                                                    </div>
                                                </div>


                                            </div>

                                            <!--pop-up-grid-->
                                        </td>
                                        <td align="center">
                                            <i class="glyphicon_x glyphicon-trash" aria-hidden="true"></i>
                                        </td>
                                    </tr>
                                }



                            </tbody>
                        </table>*@
                                <div id="tabArchivos">
                                    @if (ViewBag.perfil == "Colaborador")
                                    {
                                        @Html.Partial("_TablaArchivos", Model.Item3)
                                    }
                                    else
                                    {
                                        @Html.Partial("_TablaArchivosRevisor", Model.Item4)
                                    }
                                </div>
                                <!--termina contenido correos-->
                            </div>
                        </div>
                    </div> <!--main page chit chating end here-->

                </div>
                <div class="clearfix"> </div>





                <!--inner block end here-->
                <!--copy rights start here-->
                <!--copy rights start here-->
                @*<div class="copyrights">

            <img src=@Url.Content("~/image/gto.png") class="imgRedonda" style="display:inline" alt="GTO" width="100">

            <br><br>
            <p>SECRETAR&Iacute;A DE EDUCACI&Oacute;N DE GUANAJUATO</p>

            <p style="font-size: 12px">
                Pozuelos: Conjunto Administrativo Pozuelos S/N Guanajuato, Gto. (473) 735-1000
                Puentecillas: Carretera Guanajuato-Puentecillas km 9.5 Guanajuato, Gto. (473) 735-1200
                Profesiones: Carretera Guanajuato-Juventino Rosas km 6.5 Esq. Jazm&iacute;n, Col. Arroyo Verde (473) 10 20 200

                01 800 890 30 80
            </p>

            <a href="mailto:comunicacion_seg@seg.guanajuato.gob.mx?subject=Email%20Subject">comunicacion_seg@seg.guanajuato.gob.mx</a>





            <ul class="social-buttons" id="demo3">
                <li>
                    <a href="http://www.youtube.com/user/EducacionGuanajuato" class="brandico-youtube"><img src="http://hopedalebuilders.com/files/2018/01/youtube-icon-white.png" width="70%"></a>
                </li>
                <li>
                    <a href="https://www.facebook.com/pages/Secretar%C3%ADa-de-Educaci%C3%B3n-de-Guanajuato-SEG/340786939279382?ref=hl" class="brandico-facebook"><img src="https://amcboise.com/wp-content/uploads/2017/11/facebook.png" width="80%"></a>
                </li>
                <li>
                    <a href="https://twitter.com/ComunicacionSEG" class="brandico-twitter-bird"><img src="https://www.bh-bims.org/wp-content/uploads/2017/12/twitter-icon-white-e1513102680550.png" width="90%"></a>
                </li>


            </ul>

        </div>*@
                @Html.Partial("../ViewPartialPrincipales/_Footer")
                <!--COPY rights end here-->
            </div>
        </div>

    </div>





    <!--slide bar menu end here-->
    <!--scrolling js-->
    <script src="Administrador/js/jquery.nicescroll.js"></script>
    <script src="Administrador/js/scripts.js"></script>
    <!--//scrolling js-->
    <script src="Administrador/js/bootstrap.js"></script>
    <!-- mother grid end here-->
    }
    }

</body>
</html>
<script type="text/javascript">
    var extension = "";
    var boolExt = true;

    
    $(function () {
        $('input[type=file]').change(function () {
             extension = $(this).val().toLowerCase(),
                regex = new RegExp("(.*?)\.(jpeg|png|jpg)$");
            boolExt = true;
            if (!(regex.test(extension)) && document.getElementById("selectCampoBP").value != "Anexos") {
                alert('No se puede subir un PDF.');
                boolExt = false;
                
            }
        });
    });

    

    function SubirArchivo() {
       
        var campo = document.getElementById("selectCampoBP").value;
        var input = document.getElementById("choose_file");
        var no = document.getElementById("numArchivo").value;
        var tit = document.getElementById("tituloArchivo").value;
        var fReader = new FileReader();
        fReader.readAsDataURL(input.files[0]);
        fReader.onloadend = function (event) {
            //var img = document.getElementById("ImgCarga");
            //img.src = event.target.result;
            //var txtBox = document.getElementById("titulo");
            //txtBox.value = event.target.result;
           

            var ruta2 = event.target.result;

            if (tit == "" || no == "" || input == "") {
                alert("Titulo, número o archivo incorrectos");
            } else {
                if (campo != "Anexos" && boolExt == false) {
                    alert("Solo se aceptan imagenes")
                } else {
                    $.ajax({
                url: "@Url.Action("SubirArchivo", "BuenasPracticas")",
                method: "POST",
                data: { campoBP: campo, numBP:no, ruta: ruta2,titulo:tit, archivo:input.value},
                dataType: "html",
                success: function (response) // lowercase (not Success)
                {
                    $('#tabArchivos').html(response);
                    document.getElementById("tituloArchivo").value = "";
                    document.getElementById("numArchivo").value = "";
                    var inputImage = document.getElementById("chose_file");
                    inputImage.value = '';
                   
                },
                error: function (response) {
                    alert("Error en el filtro de la tabla.");
                }
                    })
                }

                
            }
            
        }
    }

    function SubirArchivoRevision() {
        var campo = document.getElementById("selectCampoBP").value;
        var input = document.getElementById("choose_file");
        var no = document.getElementById("numArchivo").value;
        var tit = document.getElementById("tituloArchivo").value;
        var fReader = new FileReader();
        fReader.readAsDataURL(input.files[0]);
        fReader.onloadend = function (event) {
            //var img = document.getElementById("ImgCarga");
            //img.src = event.target.result;
            //var txtBox = document.getElementById("titulo");
            //txtBox.value = event.target.result;
           

            var ruta2 = event.target.result;

            if (tit == "" || no == "" || input == "") {
                alert("Titulo, número o archivo incorrectos");
            } else {
                
                $.ajax({
                url: "@Url.Action("SubirArchivoRevision", "BuenasPracticas")",
                method: "POST",
                data: { campoBP: campo, numBP:no, ruta: ruta2,titulo:tit, archivo:input.value},
                dataType: "html",
                success: function (response) // lowercase (not Success)
                {
                    $('#tabArchivos').html(response);
                    document.getElementById("tituloArchivo").value = "";
                    document.getElementById("numArchivo").value = "";
                    var inputImage = document.getElementById("chose_file");
                    inputImage.value = '';
                   
                },
                error: function (response) {
                    alert("Error en el filtro de la tabla.");
                }
                    })
                

                
            }
            
        }
    }
</script>

